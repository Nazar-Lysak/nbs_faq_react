<?php

/**
 * @file
 * React FAQ module.
 */

/**
 * Implements hook_theme().
 */
function react_faq_theme($existing, $type, $theme, $path) {
  return [
    'paragraph__react_faq_component' => [
      'base hook' => 'paragraph',
    ],
  ];
}

/**
 * Implements hook_preprocess_paragraph().
 */
function react_faq_preprocess_paragraph(&$variables) {
  $paragraph = $variables['paragraph'];
  
  // Process only react_faq_component paragraphs.
  if ($paragraph->bundle() !== 'react_faq_component') {
    return;
  }

  // Prepare FAQ data structure.
  $faq_data = [
    'id' => $paragraph->id(),
    'title' => $paragraph->hasField('field_react_faq_title') ? ($paragraph->field_react_faq_title->value ?? '') : '',
    'description' => $paragraph->hasField('field_react_faq_description') ? ($paragraph->field_react_faq_description->value ?? '') : '',
    'items' => [],
  ];

  // Process FAQ items (child paragraphs).
  if ($paragraph->hasField('field_react_faq_list') && !$paragraph->field_react_faq_list->isEmpty()) {
    foreach ($paragraph->field_react_faq_list as $item) {
      /** @var \Drupal\paragraphs\Entity\Paragraph $child_paragraph */
      $child_paragraph = $item->entity;
      
      if ($child_paragraph && $child_paragraph->bundle() === 'react_faq_component_item') {
        $faq_data['items'][] = [
          'id' => $child_paragraph->id(),
          'subtitle' => $child_paragraph->hasField('field_react_faq_item_subtitle') ? ($child_paragraph->field_react_faq_item_subtitle->value ?? '') : '',
          'body' => $child_paragraph->hasField('field_react_faq_item_body') ? ($child_paragraph->field_react_faq_item_body->value ?? '') : '',
        ];
      }
    }
  }

  // Make data available to the template.
  $variables['faq_data'] = $faq_data;
}
